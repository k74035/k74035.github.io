---
title: "thread 생성"
excerpt: "메모장으로 사용"

categories:
  - Linux Programing
  - 
permalink: /linux-programin/linux-9/

date: 2023-11-09
last_modified_at: 2023-11-09
---

지금까지는 프로세스를 생성 및 관리하는 방법에 대해 알아보았다. 
그러나 cpu를 사용하는 방법에는 다양한 방법이 있는데 그 중 하나인 스레드이다.

프로세스안에 속해있는 스레드(Thread)는 프로세스 내에서 실행되는 실행 흐름의 단위를 나타낸다.
각각의 스레드는 프로세스의 자원을 공유하면서 독립적으로 실행될 수 있습니다. 
스레드는 경량화된 프로세스로 볼 수 있으며, 여러 스레드가 동시에 실행될 수 있습니다.
> 자원을 공유한다는 말은 하나의 독립적인 메모리 공간안에 동시에 존재한다라고 보면 되겠다. 이때 스택 공간에 스레드가 각기 저장되고 힙 영역을 공유한다.

일반적으로, 하나의 프로세스는 하나의 주 스레드(main thread)로 시작되고, 이 주 스레드에서 다른 보조 스레드들을 생성할 수 있다. 
주 스레드와 보조 스레드는 같은 프로세스 내에서 동작하면서 프로세스의 자원(메모리 등)을 공유합니다.

# 스레드의 특징:

1. 독립성: 각 스레드는 독립적인 실행 흐름을 가지며, 하나의 스레드가 종료되어도 다른 스레드는 계속 실행됩니다.
2. 공유 자원: 스레드는 같은 프로세스 내에서 실행되기 때문에 해당 프로세스의 자원을 공유합니다. 이로 인해 자원 공유와 효율적인 통신이 가능해집니다.
3. 경량화: 프로세스보다 경량화되어 있어 생성 및 관리가 상대적으로 빠르며, 오버헤드가 적습니다.
4. 효율적인 병렬 처리: 멀티코어 시스템에서 여러 스레드가 동시에 실행되면서 병렬 처리를 효과적으로 할 수 있습니다.

# thread 사용
리눅스에서 스레드를 사용하기 위해서는 pthread.h 헤더파일을 사용한다.
스레드를 생성하기 위해서는 pthread_create 라는 함수를 사용한다.

```
pthread_create(pthread_t *thread, const pthread_attr_t *attr, void *(*start_routine)(void*), void *arg)
```
다음 함수의 인수를 하나씩 살펴보자.

1. thread:
타입: pthread_t*
설명: 새로 생성된 스레드의 ID가 저장될 포인터입니다. 새로운 스레드가 생성되면 이 ID를 통해 스레드를 식별할 수 있습니다.

3. attr:
타입: const pthread_attr_t*
설명: 스레드의 특성을 정의하는 데 사용되는 구조체입니다. 일반적으로 NULL을 전달하여 기본 스레드 특성을 사용합니다.
특별한 스레드 특성이 필요하지 않은 경우 NULL을 전달하는 것이 일반적입니다.

4. start_routine:
타입: void* (*)(void*)
설명: 새로운 스레드가 시작될 때 실행될 함수의 포인터입니다. 이 함수는 스레드가 실행할 코드를 정의하며,
void*를 인수로 받고 void*를 반환합니다. 일반적으로 스레드의 진입점(entry point) 함수로 사용됩니다.

5. arg:
타입: void*
설명: start_routine 함수에 전달될 인수입니다. 스레드가 실행될 때 이 인수가 start_routine 함수에 전달되며,
스레드에서 사용할 데이터를 전달하는 데 활용됩니다.

** 리눅스 커널은 생성된 스레드들을 비동기적으로 스케줄링하여 실행한다. 따라서 두 스레드 간의 실행 순서는 예측할 수 없으며, 프로그램은 이에 의존하지 말아야 한다.**
> 간단하게 말해서 주 스레드에서 보조 스레드를 생성하는 순간부터 스레드들 간의 실행순서는 운영체제의 알고리즘에 의해 돌아가며 이것은 예측하기 어렵다는 것이다.


중요한 점은 thread를 이용하여 소스코드를 짠다면 컴파일할 때 우리는 한가지를 추가 해줘야 한다.
```
$ gcc -o file file.c -1pthread 또는 $ gcc file.c -o file -1pthread
```
이는 컴파일러에게 쓰레드 레벨 코딩을 하고 있으니 주의하라고 알려주는 컴파일러 스위치이다.

# thread 종료
스레드를 생성하는 법이 있으면 종료하는 방법도 당연히 존재한다.

1. 일반적으로 thread 함수에서 잘 실행이 되고 return값을 반환하면 스레드는 자동으로 종료가 된다.
2. 명시적으로 pthread_exit를 호출한다. 
> 이 함수는 스레드 함수 내에서 직접 혹은 다른 스레드 함수에서 호출 될 수 있다. 
이때는 pthread_exit 함수의 인수로 TID의 값을 주어야 한다.

